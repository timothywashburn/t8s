{{- range .Values.applications }}
{{- if .images }}
---
apiVersion: argocd-image-updater.argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: {{ .name }}-image-updater
  namespace: argocd
spec:
  namespace: argocd
  writeBackConfig:
    method: "argocd"
  applicationRefs:
    - namePattern: "{{ .name }}"
      images:
        {{- range .images }}
        - alias: "{{ .alias }}"
          imageName: "{{ .image }}:latest"
          commonUpdateSettings:
            updateStrategy: "newest-build"
            pullSecret: "pullsecret:{{ .pull_secret }}"
            allowTags: "regexp:^[0-9a-f]{40}$"
          manifestTargets:
            helm:
              name: "image.{{ .alias }}.name"
              tag: "image.{{ .alias }}.tag"
        {{- end }}
{{- end }}
{{- end }}
